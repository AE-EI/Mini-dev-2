<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>MiniDevis V3</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  button { display: inline-block; margin: 5px; padding: 10px; font-size: 16px; }
  .grid { display: grid; grid-template-columns: repeat(6, 50px); gap: 5px; }
  pre { background: #f0f0f0; padding: 10px; }
</style>
</head>
<body>

<h2 id="title">Choisis une pièce :</h2>
<div id="content"></div>

<script>
let devis = {};
let currentRoom = '';
let currentType = '';
let currentPose = '';

const prix = {
  "Prises - Encastree maconnerie": 120,
  "Prises - Apparent": 100,
  "Point lumineux - Encastree maconnerie": 80,
  "Point lumineux - Apparent": 70,
  "Interrupteur simple - Encastree maconnerie": 40,
  "Interrupteur simple - Apparent": 30,
  "Interrupteur double - Encastree maconnerie": 50,
  "Interrupteur double - Apparent": 40
};

function showRooms() {
  document.getElementById('title').textContent = "Choisis une pièce :";
  document.getElementById('content').innerHTML = '';
  ['Cuisine','Chambre'].forEach(room => {
    let btn = document.createElement('button');
    btn.textContent = room;
    btn.onclick = () => { currentRoom = room; if (!devis[currentRoom]) devis[currentRoom] = []; showTypes(); };
    document.getElementById('content').appendChild(btn);
  });
}

function showTypes() {
  document.getElementById('title').textContent = `Que veux-tu ajouter dans ${currentRoom} ?`;
  document.getElementById('content').innerHTML = '';
  ['Prises','Éclairage'].forEach(type => {
    let btn = document.createElement('button');
    btn.textContent = type;
    btn.onclick = () => { currentType = type; showPose(type); };
    document.getElementById('content').appendChild(btn);
  });
}

function showPose(type) {
  document.getElementById('title').textContent = `Type de pose pour ${type} :`;
  document.getElementById('content').innerHTML = '';
  ['Encastree maconnerie','Apparent'].forEach(pose => {
    let btn = document.createElement('button');
    btn.textContent = pose;
    btn.onclick = () => { currentPose = pose; askQuantity(type, pose); };
    document.getElementById('content').appendChild(btn);
  });
}

function askQuantity(type, pose) {
  document.getElementById('title').textContent = `Quantité pour ${type} (${pose}) :`;
  document.getElementById('content').innerHTML = '';
  let grid = document.createElement('div');
  grid.className = 'grid';
  for (let i = 1; i <= 10; i++) {
    let btn = document.createElement('button');
    btn.textContent = i;
    btn.onclick = () => {
      if (type === 'Prises') {
        devis[currentRoom].push(`${i} prises 2p+T - ${pose} (${prix[`Prises - ${pose}`]}€/u)`);
        showSummary();
      }
      if (type === 'Éclairage') {
        askLightingDetails(pose);
      }
    };
    grid.appendChild(btn);
  }
  document.getElementById('content').appendChild(grid);
}

function askLightingDetails(pose) {
  let details = [
    { label: "Points lumineux", key: "Point lumineux" },
    { label: "Interrupteurs simples", key: "Interrupteur simple" },
    { label: "Interrupteurs doubles", key: "Interrupteur double" }
  ];
  let index = 0;

  function askNext() {
    if (index >= details.length) {
      showSummary();
      return;
    }
    let item = details[index];
    document.getElementById('title').textContent = `${item.label} (${pose}) :`;
    document.getElementById('content').innerHTML = '';
    let grid = document.createElement('div');
    grid.className = 'grid';
    for (let i = 0; i <= 10; i++) {
      let btn = document.createElement('button');
      btn.textContent = i;
      btn.onclick = () => {
        if (i > 0) devis[currentRoom].push(`${i} ${item.key.toLowerCase()}${i>1?'s':''} - ${pose} (${prix[`${item.key} - ${pose}`]}€/u)`);
        index++;
        askNext();
      };
      grid.appendChild(btn);
    }
    document.getElementById('content').appendChild(grid);
  }

  askNext();
}

function showSummary() {
  document.getElementById('title').textContent = "Résumé du devis :";
  let html = '<pre>';
  for (let room in devis) {
    html += room + ":\n";
    devis[room].forEach(item => html += "- " + item + "\n");
    html += "\n";
  }
  html += '</pre>';
  html += '<button onclick="showRooms()">Ajouter autre chose</button> ';
  html += '<button onclick="addNote()">Ajouter une note</button> ';
  html += '<button onclick="showText()">Afficher en texte</button>';
  document.getElementById('content').innerHTML = html;
}

function addNote() {
  let note = prompt("Note :");
  if (note && currentRoom) devis[currentRoom].push(`Note : ${note}`);
  showSummary();
}

function showText() {
  let text = '';
  for (let room in devis) {
    text += room + ":\n";
    devis[room].forEach(item => text += "- " + item + "\n");
    text += "\n";
  }
  document.getElementById('title').textContent = "Version texte du devis :";
  document.getElementById('content').innerHTML = '<pre>' + text + '</pre><button onclick="showSummary()">Retour</button>';
}

showRooms();
</script>

</body>
</html>
